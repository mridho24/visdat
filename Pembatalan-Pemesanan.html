<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Cancellation Analysis</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .visualization-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }

        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .controls {
            margin: 20px 0;
            text-align: center;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin: 20px 0;
        }

        .chart {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .chart:hover {
            transform: translateY(-5px);
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .insight-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid #eef2f7;
        }

        .insight-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
        }

        .tooltip {
            position: absolute;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            pointer-events: none;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-top: 10px;
        }

        .trend-up {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .trend-down {
            background: #ffebee;
            color: #c62828;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Analisis Pembatalan Pemesanan Hotel</h2>
        
        <div class="chart-grid">
            <div class="chart">
                <h3>Pembatalan Keseluruhan</h3>
                <div id="cancellationChart"></div>
            </div>
            <div class="chart">
                <h3>Pembatalan per Jenis Hotel</h3>
                <div id="hotelTypeChart"></div>
            </div>
        </div>

        <div class="visualization-container">
            <div class="chart">
                <h3>Pembatalan berdasarkan Lead Time</h3>
                <div id="leadTimeChart"></div>
            </div>
        </div>

        <div class="visualization-container">
            <div class="chart">
                <h3>Pembatalan berdasarkan Tipe Deposit</h3>
                <div id="depositTypeChart"></div>
            </div>
        </div>

        <div class="insights-grid">
            <div class="insight-card">
                <div class="insight-header">
                    <span class="insight-icon">üìä</span>
                    <h4 class="insight-title">Total Pembatalan</h4>
                </div>
                <div class="insight-value">37.0%</div>
                <p class="insight-description">
                    Dari total pemesanan yang dilakukan
                </p>
                <div class="trend-indicator trend-down">‚Üì High Cancellation Rate</div>
            </div>

            <div class="insight-card">
                <div class="insight-header">
                    <span class="insight-icon">üè¢</span>
                    <h4 class="insight-title">City Hotel</h4>
                </div>
                <div class="insight-value">41.7%</div>
                <p class="insight-description">
                    Tingkat pembatalan tertinggi
                </p>
                <div class="trend-indicator trend-down">‚Üì Needs Attention</div>
            </div>

            <div class="insight-card">
                <div class="insight-header">
                    <span class="insight-icon">‚è∞</span>
                    <h4 class="insight-title">Lead Time >365 hari</h4>
                </div>
                <div class="insight-value">61.5%</div>
                <p class="insight-description">
                    Pembatalan tertinggi berdasarkan lead time
                </p>
                <div class="trend-indicator trend-down">‚Üì High Risk</div>
            </div>

            <div class="insight-card">
                <div class="insight-header">
                    <span class="insight-icon">üí∞</span>
                    <h4 class="insight-title">Non Refund</h4>
                </div>
                <div class="insight-value">99.1%</div>
                <p class="insight-description">
                    Pembatalan tertinggi berdasarkan tipe deposit
                </p>
                <div class="trend-indicator trend-down">‚Üì Critical</div>
            </div>
        </div>
    </div>

    <script>
        // Data preparation
        const cancellationData = [
            { status: 'Not Canceled', count: 63000, percentage: 63.0 },
            { status: 'Canceled', count: 37000, percentage: 37.0 }
        ];

        const hotelTypeData = [
            { hotel: 'City Hotel', canceled: 25000, notCanceled: 35000, percentage: 41.7 },
            { hotel: 'Resort Hotel', canceled: 12000, notCanceled: 28000, percentage: 27.7 }
        ];

        const leadTimeData = [
            { group: '0-7 days', canceled: 1500, notCanceled: 8500, percentage: 15.0 },
            { group: '8-30 days', canceled: 4500, notCanceled: 10500, percentage: 30.0 },
            { group: '31-90 days', canceled: 8000, notCanceled: 12000, percentage: 40.0 },
            { group: '91-365 days', canceled: 12000, notCanceled: 13000, percentage: 48.0 },
            { group: '>365 days', canceled: 11000, notCanceled: 7000, percentage: 61.5 }
        ];

        const depositTypeData = [
            { type: 'No Deposit', canceled: 30000, notCanceled: 58000, percentage: 34.2 },
            { type: 'Non Refund', canceled: 9000, notCanceled: 80, percentage: 99.1 },
            { type: 'Refundable', canceled: 1000, notCanceled: 25000, percentage: 3.9 }
        ];

        // Set up dimensions and margins
        const pieMargin = { top: 40, right: 30, bottom: 40, left: 30 };
        const pieWidth = 450;
        const pieHeight = 450;
        const pieRadius = Math.min(pieWidth, pieHeight) / 2 - 40;

        const barMargin = { top: 40, right: 60, bottom: 60, left: 150 };
        const barWidth = 960;
        const barHeight = 400;

        // Color scales
        const cancellationColor = d3.scaleOrdinal()
            .domain(['Not Canceled', 'Canceled'])
            .range(['#2ca02c', '#d62728']);

        const hotelColor = d3.scaleSequential(d3.interpolateReds)
            .domain([0, d3.max(hotelTypeData, d => d.percentage)]);

        const leadTimeColor = d3.scaleSequential(d3.interpolateReds)
            .domain([0, d3.max(leadTimeData, d => d.percentage)]);

        const depositColor = d3.scaleSequential(d3.interpolateReds)
            .domain([0, d3.max(depositTypeData, d => d.percentage)]);

        // Tooltip setup
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // 1. Overall Cancellation Pie Chart
        const pieSvg1 = d3.select("#cancellationChart")
            .append("svg")
            .attr("width", pieWidth + pieMargin.left + pieMargin.right)
            .attr("height", pieHeight + pieMargin.top + pieMargin.bottom)
            .append("g")
            .attr("transform", `translate(${pieWidth / 2 + pieMargin.left},${pieHeight / 2 + pieMargin.top})`);

        const pie = d3.pie()
            .value(d => d.count)
            .sort(null);

        const arc = d3.arc()
            .innerRadius(0)
            .outerRadius(pieRadius);

        const arcs1 = pieSvg1.selectAll(".arc")
            .data(pie(cancellationData))
            .enter()
            .append("g")
            .attr("class", "arc");

        arcs1.append("path")
            .attr("d", arc)
            .attr("fill", d => cancellationColor(d.data.status))
            .attr("stroke", "white")
            .attr("stroke-width", 1)
            .on("mouseover", function(event, d) {
                d3.select(this).attr("stroke-width", 2);
                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);
                tooltip.html(`${d.data.status}<br>Jumlah: ${d.data.count.toLocaleString()}<br>Persentase: ${d.data.percentage}%`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                d3.select(this).attr("stroke-width", 1);
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            });

        // Add labels to pie chart
        arcs1.append("text")
            .attr("transform", d => `translate(${arc.centroid(d)})`)
            .attr("dy", "0.35em")
            .attr("text-anchor", "middle")
            .text(d => `${d.data.status} (${d.data.percentage}%)`)
            .style("font-size", "12px")
            .style("fill", "white");

        // Add pie chart title
        pieSvg1.append("text")
            .attr("x", 0)
            .attr("y", -pieHeight / 2 + 10)
            .attr("text-anchor", "middle")
            .style("font-size", "14px")
            .style("font-weight", "bold")
            .text("Persentase Pembatalan Pemesanan");

        // 2. Hotel Type Cancellation Pie Chart
        const pieSvg2 = d3.select("#hotelTypeChart")
            .append("svg")
            .attr("width", pieWidth + pieMargin.left + pieMargin.right)
            .attr("height", pieHeight + pieMargin.top + pieMargin.bottom)
            .append("g")
            .attr("transform", `translate(${pieWidth / 2 + pieMargin.left},${pieHeight / 2 + pieMargin.top})`);

        const arcs2 = pieSvg2.selectAll(".arc")
            .data(pie(hotelTypeData.map(d => ({ status: d.hotel, count: d.canceled, percentage: d.percentage }))))
            .enter()
            .append("g")
            .attr("class", "arc");

        arcs2.append("path")
            .attr("d", arc)
            .attr("fill", d => hotelColor(d.data.percentage))
            .attr("stroke", "white")
            .attr("stroke-width", 1)
            .on("mouseover", function(event, d) {
                d3.select(this).attr("stroke-width", 2);
                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);
                tooltip.html(`${d.data.status}<br>Jumlah: ${d.data.count.toLocaleString()}<br>Persentase: ${d.data.percentage}%`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                d3.select(this).attr("stroke-width", 1);
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            });

        // Add labels to pie chart
        arcs2.append("text")
            .attr("transform", d => `translate(${arc.centroid(d)})`)
            .attr("dy", "0.35em")
            .attr("text-anchor", "middle")
            .text(d => `${d.data.status} (${d.data.percentage}%)`)
            .style("font-size", "12px")
            .style("fill", "white");

        // Add pie chart title
        pieSvg2.append("text")
            .attr("x", 0)
            .attr("y", -pieHeight / 2 + 10)
            .attr("text-anchor", "middle")
            .style("font-size", "14px")
            .style("font-weight", "bold")
            .text("Pembatalan berdasarkan Jenis Hotel");

        // 3. Lead Time Cancellation Bar Chart
        const barSvg1 = d3.select("#leadTimeChart")
            .append("svg")
            .attr("width", barWidth + barMargin.left + barMargin.right)
            .attr("height", barHeight + barMargin.top + barMargin.bottom)
            .append("g")
            .attr("transform", `translate(${barMargin.left},${barMargin.top})`);

        // X scale
        const x1 = d3.scaleLinear()
            .domain([0, d3.max(leadTimeData, d => d.percentage)])
            .range([0, barWidth]);

        // Y scale
        const y1 = d3.scaleBand()
            .domain(leadTimeData.map(d => d.group))
            .range([0, barHeight])
            .padding(0.2);

        // Add bars
        barSvg1.selectAll(".bar")
            .data(leadTimeData)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", 0)
            .attr("y", d => y1(d.group))
            .attr("width", d => x1(d.percentage))
            .attr("height", y1.bandwidth())
            .attr("fill", d => leadTimeColor(d.percentage))
            .attr("stroke", "white")
            .attr("stroke-width", 1)
            .on("mouseover", function(event, d) {
                d3.select(this).attr("stroke-width", 2);
                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);
                tooltip.html(`${d.group}<br>Jumlah: ${d.canceled.toLocaleString()}<br>Persentase: ${d.percentage}%`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                d3.select(this).attr("stroke-width", 1);
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            });

        // Add value labels
        barSvg1.selectAll(".label")
            .data(leadTimeData)
            .enter()
            .append("text")
            .attr("class", "label")
            .attr("x", d => x1(d.percentage) + 5)
            .attr("y", d => y1(d.group) + y1.bandwidth() / 2)
            .attr("dy", ".35em")
            .text(d => `${d.percentage}% (${d.canceled.toLocaleString()})`)
            .style("font-size", "12px")
            .style("fill", "#555");

        // Add axes
        barSvg1.append("g")
            .attr("class", "x axis")
            .attr("transform", `translate(0,${barHeight})`)
            .call(d3.axisBottom(x1).ticks(5).tickFormat(d => `${d}%`));

        barSvg1.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(y1));

        // Add chart title
        barSvg1.append("text")
            .attr("x", barWidth / 2)
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .style("font-weight", "bold")
            .text("Persentase Pembatalan berdasarkan Lead Time");

        // 4. Deposit Type Cancellation Bar Chart
        const barSvg2 = d3.select("#depositTypeChart")
            .append("svg")
            .attr("width", barWidth + barMargin.left + barMargin.right)
            .attr("height", barHeight + barMargin.top + barMargin.bottom)
            .append("g")
            .attr("transform", `translate(${barMargin.left},${barMargin.top})`);

        // X scale
        const x2 = d3.scaleLinear()
            .domain([0, d3.max(depositTypeData, d => d.percentage)])
            .range([0, barWidth]);

        // Y scale
        const y2 = d3.scaleBand()
            .domain(depositTypeData.map(d => d.type))
            .range([0, barHeight])
            .padding(0.2);

        // Add bars
        barSvg2.selectAll(".bar")
            .data(depositTypeData)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", 0)
            .attr("y", d => y2(d.type))
            .attr("width", d => x2(d.percentage))
            .attr("height", y2.bandwidth())
            .attr("fill", d => depositColor(d.percentage))
            .attr("stroke", "white")
            .attr("stroke-width", 1)
            .on("mouseover", function(event, d) {
                d3.select(this).attr("stroke-width", 2);
                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);
                tooltip.html(`${d.type}<br>Jumlah: ${d.canceled.toLocaleString()}<br>Persentase: ${d.percentage}%`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function() {
                d3.select(this).attr("stroke-width", 1);
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            });

        // Add value labels
        barSvg2.selectAll(".label")
            .data(depositTypeData)
            .enter()
            .append("text")
            .attr("class", "label")
            .attr("x", d => x2(d.percentage) + 5)
            .attr("y", d => y2(d.type) + y2.bandwidth() / 2)
            .attr("dy", ".35em")
            .text(d => `${d.percentage}% (${d.canceled.toLocaleString()})`)
            .style("font-size", "12px")
            .style("fill", "#555");

        // Add axes
        barSvg2.append("g")
            .attr("class", "x axis")
            .attr("transform", `translate(0,${barHeight})`)
            .call(d3.axisBottom(x2).ticks(5).tickFormat(d => `${d}%`));

        barSvg2.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(y2));

        // Add chart title
        barSvg2.append("text")
            .attr("x", barWidth / 2)
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .style("font-weight", "bold")
            .text("Persentase Pembatalan berdasarkan Tipe Deposit");
    </script>
</body>
</html>